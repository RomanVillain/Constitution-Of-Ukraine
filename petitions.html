<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Електронні Петиції - Діджиталізована Конституція України</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css" />
    <link rel="icon" type="image/png" href="assets/herb.png">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }

        body {
            margin: 20px;
            padding: 0;
        }

        header {
            background-color: #00529b;
            color: #fff;
            text-align: center;
            padding: 20px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        header input[type="text"] {
            padding: 10px;
            margin: 10px auto;
            border: none;
            border-radius: 5px;
            width: 80%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        section {
            margin: 20px 0;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        section h2 {
            color: #00529b;
        }

        section .petition {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        section .petition:last-child {
            border-bottom: none;
        }

        section a {
            color: #00529b;
            text-decoration: none;
            font-weight: bold;
        }

        section a:hover {
            text-decoration: underline;
        }

        .btn-sign {
            background-color: #00529b;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            display: inline-block;
            text-decoration: none;
        }

        .btn-sign:hover {
            background-color: #003f7f;
        }

        @media only screen and (max-width: 600px) {
            header input[type="text"] {
                width: auto;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Електронні Петиції - Діджиталізована Конституція України</h1>
        <input type="text" placeholder="Пошук...">
    </header>

    <section>
        <h2>Електронні Петиції</h2>
        <div id="petition-list">
            <!-- Petitions will be dynamically inserted here -->
        </div>
    </section>

    <script>
        const apiUrl = 'https://example.com/api/petitions'; // Змініть на реальний URL API

        async function fetchPetitions() {
            try {
                console.log('Fetching petitions from API...');
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        // Якщо сервер потребує додаткових заголовків:
                        'Authorization': 'Bearer YOUR_ACCESS_TOKEN' // Замініть на реальний токен
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const petitions = await response.json();
                console.log('Fetched petitions:', petitions);
                renderPetitions(petitions);
            } catch (error) {
                console.error('Error fetching petitions:', error);
                alert('Не вдалося завантажити петиції. Спробуйте ще раз пізніше.');
            }
        }

        function renderPetitions(petitions) {
            const petitionListDiv = document.getElementById('petition-list');
            petitionListDiv.innerHTML = ''; // Clear previous list

            petitions.forEach(petition => {
                const petitionDiv = document.createElement('div');
                petitionDiv.classList.add('petition');
                petitionDiv.innerHTML = `
                    <h3>${petition.title}</h3>
                    <p>${petition.description}</p>
                    <p><strong>Підписів: </strong>${petition.signatures}</p>
                    <button class="btn-sign" onclick="signPetition(${petition.id})">Підписати</button>
                `;
                petitionListDiv.appendChild(petitionDiv);
            });
        }

        async function signPetition(id) {
            try {
                console.log(`Signing petition with ID: ${id}`);
                const response = await fetch(`${apiUrl}/${id}/sign`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Якщо сервер потребує додаткових заголовків:
                        'Authorization': 'Bearer YOUR_ACCESS_TOKEN' // Замініть на реальний токен
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const result = await response.json();
                if (result.success) {
                    alert('Ви підписали петицію!');
                    fetchPetitions(); // Оновлюємо список петицій
                } else {
                    alert('Не вдалося підписати петицію. Спробуйте ще раз.');
                }
            } catch (error) {
                console.error('Error signing petition:', error);
                alert('Виникла помилка при підписанні петиції.');
            }
        }

        fetchPetitions(); // Fetch and display petitions on page load
    </script>
</body>

</html>
